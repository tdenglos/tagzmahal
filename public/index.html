<html>
  
  <head>
    <title>TagzMahal</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="//cdn.rawgit.com/feathersjs/feathers-chat/v0.1.0/public/base.css">
    <link rel="stylesheet" href="//cdn.rawgit.com/feathersjs/feathers-chat/v0.1.0/public/chat.css">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
  </head>
  
  <body> 

    <p></p>
    <p></p>
    <center><img class="logo" src='./tagzmahal_logo.png' height='40px'></center>

    <main class="login container">
      
      <div class="row">
        <div class="col-12 col-6-tablet push-3-tablet text-center">
          <h1 class="font-100">Launch a test run:</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-6-tablet push-3-tablet col-4-desktop push-4-desktop text-center">
   
<!--
          <form class="form" method="post" action="/testruns">
            
            <button type="submit" class="button button-primary block login">
              Run
            </button>


          </form>
-->
          <input type="button" class="button button-primary block login" value="Run" id="poke" />
          <p></p>
          <textarea id="runResults" style="width: 100%; height: 60px;">Please give an insruction.</textarea>
          <p></p>
<!--          <input type="button" class="button button-primary block login" value="Refresh dashboard" id="dashboard_button" />   -->
              <h2 class="font-100">Dashboard:</h1>
          <p></p>
          <textarea id="dashboard" style="width: 100%; height: 180px;">Loading...</textarea>


          <script>
              $('#poke').click(function () {
                  var runResults = document.getElementById("runResults");
                  var timestamp = Date.now();
                  var user = 'Anonymous';
                  runResults.innerHTML += "\n---\nRequest for run sent with ID " + timestamp + "\n";
                  var data = $.param({
                      timestamp: timestamp,
                      user: user
                  });         
                  var config = {
                      headers : {
                          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'
                      }
                  };
                  $.post('/testruns', data, config)
                    .success(function (data) {
                      //$scope.runResponse = data;
                      runResults.innerHTML += data.runStatus ;
                      runResults.scrollTop = runResults.scrollHeight;
                    }).error(
                      function (data, status, header, config) {
                        runResults.innerHTML = 'Error';
                      }
                    )
                  ;
              })
              
    /*          $('#dashboard_button').click(function () {
                  var dashboard = document.getElementById("dashboard");
                  var user = 'Anonymous';
                  clearText(dashboard);
                  var data = $.param({
                      user: user
                  });         
                  var config = {
                      headers : {
                          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'
                      }
                  };
                  $.get('http://localhost:3030/runstatuses', data, config)
                    .success(function (data) {
                      //$scope.runResponse = data;
                      for (var k in data){
                        dashboard.innerHTML += 'Run ' + data[k].id + ' : ' + data[k].status + "\n";  

                      }
                      
                    }).error(
                      function (data, status, header, config) {
                        runResults.innerHTML = 'Error';
                      }
                    )
                  ; 
              })
*/
              
              function refreshDashboard(){
                  var dashboard = document.getElementById("dashboard");
                  var user = 'Anonymous';
                  clearText(dashboard);
                  var data = $.param({
                      user: user
                  });         
                  var config = {
                      headers : {
                          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8;'
                      }
                  };
                  $.get('/runstatuses', data, config)
                    .success(function (data) {
                      //$scope.runResponse = data;
                      for (var k in data){
                        dashboard.innerHTML += 'Run ' + data[k].id + ' : ' + data[k].status + "\n";  

                      }
                      dashboard.scrollTop = dashboard.scrollHeight;
                      
                    }).error(
                      function (data, status, header, config) {
                        runResults.innerHTML = 'Error';
                      }
                    )
                  ;
              }

              window.onload=function()
              {
                refreshDashboard();
                setInterval('refreshDashboard()',5000);
              };

              function clearText(element){
                element.innerHTML = '';
                //console.log(element + ' cleared');
              }



          </script>




        </div>
      </div>
    </main>

  </body>

</html>



